<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Radhe Krishna File Library</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background-color: #fefefe;
    color: #111;
    transition: background 0.3s, color 0.3s;
  }
  body.dark {
    background-color: #111;
    color: #fefefe;
  }
  h1 { text-align: center; }
  form { margin-bottom: 20px; }
  input, button { margin: 5px 0; padding: 5px; }
  ul { list-style: none; padding-left: 0; }
  li { margin-bottom: 10px; }
  button { margin-left: 5px; }
  #dark-toggle { position: fixed; top: 10px; right: 10px; cursor: pointer; }
</style>
</head>
<body>

<h1>Radhe Krishna File Library</h1>
<p style="text-align:center;">Secure personal document space with voice search</p>

<button id="dark-toggle">☀️ Light/Dark</button>

<hr>

<!-- LOGIN -->
<form id="login-form">
  <input type="text" name="username" placeholder="Username" required>
  <input type="password" name="password" placeholder="Password" required>
  <button type="submit">Login</button>
</form>

<!-- UPLOAD -->
<form id="upload-form">
  <input type="file" id="file-input" required>
  <button type="submit">Upload</button>
</form>

<!-- SEARCH -->
<input type="text" id="search-input" placeholder="Search files...">

<!-- FILE LIST -->
<ul id="files-list"></ul>

<script>
const API_URL = "https://radhe-krishna-h7lq.onrender.com";

const loginForm = document.getElementById("login-form");
const uploadForm = document.getElementById("upload-form");
const fileInput = document.getElementById("file-input");
const filesContainer = document.getElementById("files-list");
const searchInput = document.getElementById("search-input");
const darkToggle = document.getElementById("dark-toggle");

// ===== DARK MODE =====
darkToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark");
});

// ===== LOGIN =====
loginForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const username = loginForm.username.value;
  const password = loginForm.password.value;

  try {
    const res = await fetch(`${API_URL}/login`, {
      method: "POST",
      credentials: "include",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });
    const data = await res.json();
    if (data.success) {
      alert("Login successful");
      loadFiles();
    } else {
      alert("Login failed");
    }
  } catch (err) {
    console.error(err);
    alert("Login error");
  }
});

// ===== UPLOAD =====
uploadForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const file = fileInput.files[0];
  if (!file) return alert("Choose a file");

  const formData = new FormData();
  formData.append("file", file);

  try {
    const res = await fetch(`${API_URL}/upload`, {
      method: "POST",
      credentials: "include",
      body: formData
    });
    const data = await res.json();
    if (data.success) {
      alert("Upload successful");
      fileInput.value = "";
      loadFiles();
    } else {
      alert("Upload failed");
    }
  } catch (err) {
    console.error(err);
    alert("Upload error");
  }
});

// ===== LIST FILES =====
async function loadFiles() {
  try {
    const res = await fetch(`${API_URL}/files`, { credentials: "include" });
    const files = await res.json();

    filesContainer.innerHTML = "";
    if (!Array.isArray(files)) return;

    files
      .filter(f => f.toLowerCase().includes(searchInput.value.toLowerCase()))
      .forEach(f => {
        const li = document.createElement("li");
        li.textContent = f;

        const downloadBtn = document.createElement("button");
        downloadBtn.textContent = "Download";
        downloadBtn.onclick = async () => {
          const res = await fetch(`${API_URL}/file/${encodeURIComponent(f)}`, { credentials: "include" });
          const data = await res.json();
          if (data.url) window.open(data.url, "_blank");
        };

        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "Delete";
        deleteBtn.onclick = async () => {
          const res = await fetch(`${API_URL}/file/${encodeURIComponent(f)}`, {
            method: "DELETE",
            credentials: "include"
          });
          const data = await res.json();
          if (data.success) loadFiles();
        };

        li.appendChild(downloadBtn);
        li.appendChild(deleteBtn);
        filesContainer.appendChild(li);
      });
  } catch (err) {
    console.error("Failed to fetch files:", err);
  }
}

// ===== SEARCH =====
searchInput.addEventListener("input", loadFiles);

// ===== INITIAL LOAD =====
loadFiles();
</script>

</body>
</html>
